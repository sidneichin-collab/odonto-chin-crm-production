{
  "query": "-- Insert SENT reminders\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, message_id, delivery_status, created_at)\nSELECT \n    a.id, a.patient_id, '2_days_before_10h',\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    'sent', p.phone, CONCAT('msg_', a.id, '_sent'), 'delivered', NOW()\nFROM appointments a JOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE() AND a.appointment_date <= DATE_ADD(CURDATE(), INTERVAL 7 DAY) LIMIT 5;\n\n-- Insert PENDING reminders\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, status, whatsapp_number, created_at)\nSELECT \n    a.id, a.patient_id, '1_day_before_10h',\n    DATE_SUB(a.appointment_date, INTERVAL 1 DAY),\n    'pending', p.phone, NOW()\nFROM appointments a JOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date > DATE_ADD(CURDATE(), INTERVAL 1 DAY) LIMIT 3;\n\n-- Insert FAILED reminders\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, error_message, created_at)\nSELECT \n    a.id, a.patient_id, '2_days_before_15h',\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    'failed', p.phone, 'WhatsApp channel not connected', NOW()\nFROM appointments a JOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE() LIMIT 2;\n\n-- Insert CONFIRMED responses\nINSERT INTO reminder_responses (appointment_id, patient_id, message_text, detected_intent, detected_keywords, received_at, processed, created_at)\nSELECT \n    a.id, a.patient_id, 'Sí, confirmo mi cita', 'confirmed', 'confirmo,sí',\n    DATE_SUB(NOW(), INTERVAL 1 DAY), 1, NOW()\nFROM appointments a\nWHERE a.appointment_date >= CURDATE() LIMIT 3",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3dy73aS7obdDVgV.73116cb9d21b --database Xh2xRagQAoY5NjF5TC3DfV --execute -- Insert SENT reminders\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, message_id, delivery_status, created_at)\nSELECT \n    a.id, a.patient_id, '2_days_before_10h',\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    'sent', p.phone, CONCAT('msg_', a.id, '_sent'), 'delivered', NOW()\nFROM appointments a JOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE() AND a.appointment_date <= DATE_ADD(CURDATE(), INTERVAL 7 DAY) LIMIT 5;\n\n-- Insert PENDING reminders\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, status, whatsapp_number, created_at)\nSELECT \n    a.id, a.patient_id, '1_day_before_10h',\n    DATE_SUB(a.appointment_date, INTERVAL 1 DAY),\n    'pending', p.phone, NOW()\nFROM appointments a JOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date > DATE_ADD(CURDATE(), INTERVAL 1 DAY) LIMIT 3;\n\n-- Insert FAILED reminders\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, error_message, created_at)\nSELECT \n    a.id, a.patient_id, '2_days_before_15h',\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY),\n    'failed', p.phone, 'WhatsApp channel not connected', NOW()\nFROM appointments a JOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE() LIMIT 2;\n\n-- Insert CONFIRMED responses\nINSERT INTO reminder_responses (appointment_id, patient_id, message_text, detected_intent, detected_keywords, received_at, processed, created_at)\nSELECT \n    a.id, a.patient_id, 'Sí, confirmo mi cita', 'confirmed', 'confirmo,sí',\n    DATE_SUB(NOW(), INTERVAL 1 DAY), 1, NOW()\nFROM appointments a\nWHERE a.appointment_date >= CURDATE() LIMIT 3",
  "rows": [],
  "messages": [],
  "stdout": "",
  "stderr": "",
  "execution_time_ms": 539
}