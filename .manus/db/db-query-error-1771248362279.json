{
  "query": "-- Insert SENT reminders (status='sent')\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, message_id, delivery_status, created_at)\nSELECT \n    a.id as appointment_id,\n    a.patient_id,\n    '2_days_before_10h' as reminder_type,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as scheduled_at,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as sent_at,\n    'sent' as status,\n    p.phone as whatsapp_number,\n    CONCAT('msg_', a.id, '_sent') as message_id,\n    'delivered' as delivery_status,\n    NOW() as created_at\nFROM appointments a\nJOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE() AND a.appointment_date <= DATE_ADD(CURDATE(), INTERVAL 7 DAY)\nLIMIT 5;\n\n-- Insert PENDING reminders (status='pending')\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, status, whatsapp_number, created_at)\nSELECT \n    a.id as appointment_id,\n    a.patient_id,\n    '1_day_before_10h' as reminder_type,\n    DATE_SUB(a.appointment_date, INTERVAL 1 DAY) as scheduled_at,\n    'pending' as status,\n    p.phone as whatsapp_number,\n    NOW() as created_at\nFROM appointments a\nJOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date > DATE_ADD(CURDATE(), INTERVAL 1 DAY)\nLIMIT 3;\n\n-- Insert FAILED reminders (status='failed')\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, error_message, created_at)\nSELECT \n    a.id as appointment_id,\n    a.patient_id,\n    '2_days_before_15h' as reminder_type,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as scheduled_at,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as sent_at,\n    'failed' as status,\n    p.phone as whatsapp_number,\n    'WhatsApp channel not connected' as error_message,\n    NOW() as created_at\nFROM appointments a\nJOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE()\nLIMIT 2;",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway02.us-east-1.prod.aws.tidbcloud.com --port 4000 --user 3dy73aS7obdDVgV.73116cb9d21b --database Xh2xRagQAoY5NjF5TC3DfV --execute -- Insert SENT reminders (status='sent')\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, message_id, delivery_status, created_at)\nSELECT \n    a.id as appointment_id,\n    a.patient_id,\n    '2_days_before_10h' as reminder_type,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as scheduled_at,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as sent_at,\n    'sent' as status,\n    p.phone as whatsapp_number,\n    CONCAT('msg_', a.id, '_sent') as message_id,\n    'delivered' as delivery_status,\n    NOW() as created_at\nFROM appointments a\nJOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE() AND a.appointment_date <= DATE_ADD(CURDATE(), INTERVAL 7 DAY)\nLIMIT 5;\n\n-- Insert PENDING reminders (status='pending')\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, status, whatsapp_number, created_at)\nSELECT \n    a.id as appointment_id,\n    a.patient_id,\n    '1_day_before_10h' as reminder_type,\n    DATE_SUB(a.appointment_date, INTERVAL 1 DAY) as scheduled_at,\n    'pending' as status,\n    p.phone as whatsapp_number,\n    NOW() as created_at\nFROM appointments a\nJOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date > DATE_ADD(CURDATE(), INTERVAL 1 DAY)\nLIMIT 3;\n\n-- Insert FAILED reminders (status='failed')\nINSERT INTO reminder_queue (appointment_id, patient_id, reminder_type, scheduled_at, sent_at, status, whatsapp_number, error_message, created_at)\nSELECT \n    a.id as appointment_id,\n    a.patient_id,\n    '2_days_before_15h' as reminder_type,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as scheduled_at,\n    DATE_SUB(a.appointment_date, INTERVAL 2 DAY) as sent_at,\n    'failed' as status,\n    p.phone as whatsapp_number,\n    'WhatsApp channel not connected' as error_message,\n    NOW() as created_at\nFROM appointments a\nJOIN patients p ON a.patient_id = p.id\nWHERE a.appointment_date >= CURDATE()\nLIMIT 2;",
  "returncode": 1,
  "logs": [
    "ERROR 1146 (42S02) at line 2: Table 'xh2xragqaoy5njf5tc3dfv.reminder_queue' doesn't exist"
  ]
}